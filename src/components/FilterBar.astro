---
import Input from './ui/Input.astro';
import Select from './ui/Select.astro';
import { type TimeCategory, timeCategoryLabels, type Country, countryLabels } from '../data/stalls';

interface Props {
  areas: string[];
  timeCategories: TimeCategory[];
  cuisines?: { id: string; label: string; count: number }[];
  countries?: Country[];
  totalCount: number;
  showCuisineFilter?: boolean;
  showCountryFilter?: boolean;
  defaultCountry?: string;
}

const { areas, timeCategories, cuisines = [], countries = [], totalCount, showCuisineFilter = false, showCountryFilter = false, defaultCountry = '' } = Astro.props;

const ratingOptions = [
  { value: '3', label: 'Must Try (3)' },
  { value: '2', label: 'Worth Trying (2)' },
  { value: '1', label: 'Skip (1)' },
  { value: 'unrated', label: 'Unrated' },
];

const countryOptions = countries.map((c) => ({ value: c, label: countryLabels[c] }));

const areaOptions = areas.map((a) => ({ value: a, label: a }));

const timeOptions = timeCategories.map((t) => ({
  value: t,
  label: timeCategoryLabels[t],
}));

const cuisineOptions = cuisines.map((c) => ({
  value: c.id,
  label: `${c.label} (${c.count})`,
}));

const sortOptions = [
  { value: 'rating-desc', label: 'Highest Rated' },
  { value: 'rating-asc', label: 'Lowest Rated' },
  { value: 'price-asc', label: 'Cheapest First' },
  { value: 'price-desc', label: 'Priciest First' },
  { value: 'episode-asc', label: 'Episode Order' },
];
---

<section class="sticky top-0 z-30 border-b border-warm-800/60 bg-surface/90 backdrop-blur-xl">
  <div class="mx-auto max-w-6xl px-4 py-3">
    <div class="flex flex-col sm:flex-row gap-3">
      <div class="flex-1">
        <Input
          id="search"
          type="text"
          icon="i-ph-magnifying-glass"
          placeholder="Search stalls, dishes, areas..."
        />
      </div>

      <div class="flex gap-2 overflow-x-auto sm:flex-wrap sm:overflow-visible pb-1 sm:pb-0">
        <Select id="filter-rating" options={ratingOptions} placeholder="All Ratings" />
        <Select id="filter-area" options={areaOptions} placeholder="All Areas" />
        <Select id="filter-time" options={timeOptions} placeholder="All Hours" />
        {showCountryFilter && (
          <Select id="filter-country" options={countryOptions} placeholder="All Countries" data-default={defaultCountry} />
        )}
        {showCuisineFilter && (
          <Select id="filter-cuisine" options={cuisineOptions} placeholder="All Cuisines" />
        )}
        <Select id="sort-by" options={sortOptions} />
      </div>
    </div>

    <!-- Active filter chips -->
    <div id="active-filters" class="hidden overflow-x-auto sm:flex-wrap gap-2 mt-2"></div>

    <!-- Quick toggles -->
    <div class="flex items-center gap-3 mt-2">
      <label class="inline-flex items-center gap-1.5 text-xs text-ink-muted cursor-pointer select-none">
        <input type="checkbox" id="filter-favorites" class="accent-flame-500 w-3.5 h-3.5" />
        <span class="i-ph-heart-fill text-flame-400 text-xs" />
        Favorites only
      </label>
      <label class="inline-flex items-center gap-1.5 text-xs text-ink-muted cursor-pointer select-none">
        <input type="checkbox" id="filter-hide-visited" class="accent-flame-500 w-3.5 h-3.5" />
        <span class="i-ph-eye-slash text-ink-faint text-xs" />
        Hide visited
      </label>
      <!-- Result count -->
      <p id="result-count" class="text-ink-faint text-xs ml-auto">
        Showing {totalCount} stalls
      </p>
    </div>
  </div>
</section>
