---
import { cn } from "../utils";

interface Datum {
  label: string;
  value: number;
}

interface Props {
  data?: Datum[];
  class?: string;
  horizontal?: boolean;
  stacked?: boolean;
  [key: string]: any;
}

const {
  data = [
    { label: "A", value: 18 },
    { label: "B", value: 26 },
    { label: "C", value: 14 },
    { label: "D", value: 30 },
  ],
  class: className,
  horizontal = false,
  stacked = false,
  ...attrs
} = Astro.props as Props;

const max = Math.max(...data.map((item) => item.value), 1);
const total = data.reduce((sum, item) => sum + item.value, 0);
---

<div data-slot="categorical-chart" class={cn("w-full", className)} {...attrs}>
  {stacked ? (
    <div class="bg-muted flex h-6 w-full overflow-hidden rounded-md">
      {data.map((item) => (
        <div
          title={`${item.label}: ${item.value}`}
          class="bg-primary/60 border-r border-surface last:border-r-0"
          style={`width: ${(item.value / Math.max(total, 1)) * 100}%;`}
        />
      ))}
    </div>
  ) : horizontal ? (
    <div class="space-y-2">
      {data.map((item) => (
        <div class="space-y-1">
          <div class="flex items-center justify-between text-xs">
            <span>{item.label}</span>
            <span class="text-foreground-muted">{item.value}</span>
          </div>
          <div class="bg-muted h-2 w-full overflow-hidden rounded-full">
            <div class="bg-primary/70 h-full" style={`width: ${(item.value / max) * 100}%;`} />
          </div>
        </div>
      ))}
    </div>
  ) : (
    <div class="flex h-40 items-end gap-2">
      {data.map((item) => (
        <div class="flex min-w-0 flex-1 flex-col items-center gap-1">
          <div
            class="bg-primary/70 w-full rounded-t"
            style={`height: ${(item.value / max) * 100}%;`}
            title={`${item.label}: ${item.value}`}
          />
          <span class="text-foreground-muted text-xs">{item.label}</span>
        </div>
      ))}
    </div>
  )}
</div>
