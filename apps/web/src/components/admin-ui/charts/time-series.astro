---
import { cn } from "../utils";

interface Datum {
  label: string;
  value: number;
}

interface Props {
  data?: Datum[];
  class?: string;
  [key: string]: any;
}

const {
  data = [
    { label: "Jan", value: 8 },
    { label: "Feb", value: 11 },
    { label: "Mar", value: 15 },
    { label: "Apr", value: 13 },
    { label: "May", value: 19 },
    { label: "Jun", value: 22 },
  ],
  class: className,
  ...attrs
} = Astro.props as Props;

const min = Math.min(...data.map((item) => item.value), 0);
const max = Math.max(...data.map((item) => item.value), 1);
const range = Math.max(max - min, 1);

const linePoints = data
  .map((item, index) => {
    const x = data.length === 1 ? 50 : (index / (data.length - 1)) * 100;
    const y = 100 - ((item.value - min) / range) * 100;
    return `${x},${y}`;
  })
  .join(" ");
---

<div data-slot="time-series-chart" class={cn("w-full", className)} {...attrs}>
  <svg viewBox="0 0 100 100" class="h-44 w-full" preserveAspectRatio="none">
    <polyline points={linePoints} fill="none" stroke="var(--color-primary)" stroke-width="2" vector-effect="non-scaling-stroke" />
    {data.map((item, index) => {
      const x = data.length === 1 ? 50 : (index / (data.length - 1)) * 100;
      const y = 100 - ((item.value - min) / range) * 100;
      return <circle cx={x} cy={y} r="1.6" fill="var(--color-primary)" />;
    })}
  </svg>

  <div class="text-foreground-muted mt-2 flex flex-wrap gap-2 text-xs">
    {data.map((item) => (
      <span class="rounded bg-muted px-2 py-1">{item.label}: {item.value}</span>
    ))}
  </div>
</div>
