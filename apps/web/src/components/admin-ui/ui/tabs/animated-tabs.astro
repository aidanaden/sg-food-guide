---
import { cn } from "../../utils";

interface Option {
  value: string;
  label: string;
}

interface Props {
  options: Option[];
  value?: string;
  class?: string;
  [key: string]: any;
}

const { options, value, class: className, ...attrs } = Astro.props as Props;
const activeValue = value ?? options[0]?.value ?? "";
const id = `animated-tabs-${Math.random().toString(36).slice(2, 10)}`;
---

<div
  id={id}
  data-slot="animated-tabs"
  data-animated-tabs
  data-value={activeValue}
  class={cn("bg-muted/50 inline-flex items-center rounded-lg p-0.5", className)}
  {...attrs}
>
  {options.map((option) => (
    <button
      type="button"
      data-slot="animated-tabs-trigger"
      data-animated-tabs-trigger
      data-value={option.value}
      data-active={option.value === activeValue ? "true" : "false"}
      aria-pressed={option.value === activeValue ? "true" : "false"}
      class={cn(
        "relative rounded-md px-3 py-1.5 text-sm font-medium transition-colors",
        "text-foreground-muted hover:text-foreground",
        option.value === activeValue ? "bg-background text-foreground" : undefined,
      )}
    >
      {option.label}
    </button>
  ))}
</div>

<script is:inline>
  const roots = document.querySelectorAll("[data-animated-tabs]");

  roots.forEach((root) => {
    if (root.__animatedTabsInit) {
      return;
    }
    root.__animatedTabsInit = true;

    const triggers = Array.from(root.querySelectorAll("[data-animated-tabs-trigger]"));

    const setActive = (nextValue, emit = true) => {
      root.dataset.value = nextValue;

      triggers.forEach((trigger) => {
        const isActive = trigger.getAttribute("data-value") === nextValue;
        trigger.setAttribute("data-active", isActive ? "true" : "false");
        trigger.setAttribute("aria-pressed", isActive ? "true" : "false");
        trigger.classList.toggle("bg-background", isActive);
        trigger.classList.toggle("text-foreground", isActive);
        trigger.classList.toggle("text-foreground-muted", !isActive);
      });

      if (emit) {
        root.dispatchEvent(
          new CustomEvent("animated-tabs:change", {
            bubbles: true,
            detail: { value: nextValue },
          }),
        );
      }
    };

    triggers.forEach((trigger) => {
      trigger.addEventListener("click", () => {
        const value = trigger.getAttribute("data-value") ?? "";
        setActive(value);
      });
    });
  });
</script>
