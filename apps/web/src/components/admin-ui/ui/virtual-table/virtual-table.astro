---
import { cn } from "../../utils";

interface Column {
  key: string;
  header: string;
}

interface Props {
  columns?: Column[];
  rows?: Record<string, any>[];
  class?: string;
  emptyText?: string;
  [key: string]: any;
}

const {
  columns = [],
  rows = [],
  class: className,
  emptyText = "No rows",
  ...attrs
} = Astro.props as Props;

const resolvedColumns =
  columns.length > 0
    ? columns
    : rows.length > 0
      ? Object.keys(rows[0] ?? {}).map((key) => ({ key, header: key }))
      : [];
---

<div data-slot="virtual-table" class={cn("overflow-auto", className)} {...attrs}>
  {rows.length === 0 ? (
    <div class="text-foreground-muted px-3 py-4 text-sm">{emptyText}</div>
  ) : (
    <table class="w-full border-collapse text-sm">
      <thead class="bg-muted/50">
        <tr>
          {resolvedColumns.map((column) => (
            <th class="border-border border-b px-3 py-2 text-left font-medium">{column.header}</th>
          ))}
        </tr>
      </thead>
      <tbody>
        {rows.map((row) => (
          <tr>
            {resolvedColumns.map((column) => (
              <td class="border-border border-b px-3 py-2 align-top">
                {String(row[column.key] ?? "")}
              </td>
            ))}
          </tr>
        ))}
      </tbody>
    </table>
  )}
</div>
