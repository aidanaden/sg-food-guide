---
import Layout from '../layouts/Layout.astro';
import StallCard from '../components/StallCard.astro';
import FilterBar from '../components/FilterBar.astro';
import RoutePlanner from '../components/RoutePlanner.astro';
import Badge from '../components/ui/Badge.astro';
import { stalls, getAreas, getAllTimeCategories, getCuisines, getCountries } from '../data/stalls';

const areas = getAreas();
const timeCategories = getAllTimeCategories();
const cuisines = getCuisines();
const countries = getCountries();
const mustTryCount = stalls.filter((s) => (s.ratingModerated ?? 0) >= 3).length;
---

<Layout title="SG Food Guide — Best Hawker Food in Singapore" description={`The definitive guide to Singapore's best hawker food — ${stalls.length} stalls ranked, mapped, and reviewed across ${cuisines.length} cuisines.`} canonicalPath="/">
  <!-- Hero -->
  <header class="relative overflow-hidden border-b border-warm-800">
    <div class="absolute inset-0 bg-gradient-to-br from-warm-950 via-surface to-warm-900 opacity-80"></div>
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--color-flame-600)_0%,_transparent_50%)] opacity-15"></div>
    <div class="relative mx-auto max-w-6xl px-4 py-16 sm:py-20">
      <div class="flex items-start gap-3 mb-4">
        <span class="i-ph-bowl-food-fill text-flame-400 text-3xl sm:text-4xl mt-1 shrink-0"></span>
        <div>
          <h1 class="font-display text-4xl sm:text-5xl lg:text-6xl font-800 tracking-tight">
            <span class="text-flame-400">SG</span> Food Guide
          </h1>
          <p class="text-ink-muted text-lg sm:text-xl mt-2 max-w-xl leading-relaxed">
            The definitive ranking of Singapore's best hawker food. {stalls.length} stalls reviewed and ranked.
          </p>
        </div>
      </div>

      <!-- Stats -->
      <div class="flex flex-wrap gap-6 mt-8 text-sm">
        <div class="flex items-center gap-2">
          <span class="i-ph-fork-knife text-warm-400"></span>
          <span class="text-ink-muted"><strong class="text-ink font-semibold">{stalls.length}</strong> stalls</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="i-ph-trophy-fill text-gold-400"></span>
          <span class="text-ink-muted"><strong class="text-ink font-semibold">{stalls.filter(s => s.awards.length > 0).length}</strong> award winners</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="i-ph-star-fill text-jade-400"></span>
          <span class="text-ink-muted"><strong class="text-ink font-semibold">{mustTryCount}</strong> must-try</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="i-ph-currency-dollar text-warm-400"></span>
          <span class="text-ink-muted">$4–$10 range</span>
        </div>
      </div>

      <!-- Cuisine links -->
      <div class="flex flex-wrap gap-2 mt-6">
        {cuisines.map((c) => (
          <a href={`/cuisine/${c.id}`}>
            <Badge variant="cuisine" size="md">
              <span class="i-ph-bowl-food text-xs" />
              {c.label}
              <span class="text-flame-400/50 ml-0.5">{c.count}</span>
            </Badge>
          </a>
        ))}
      </div>

      <!-- Route planner toggle -->
      <div class="mt-6">
        <RoutePlanner />
      </div>

      <div class="mt-3">
        <a
          href="/adventure"
          class="inline-flex min-h-11 items-center gap-2 rounded-lg border border-warm-700/60 bg-surface-raised px-4 py-2 text-sm text-ink-muted transition-colors hover:border-flame-500/50 hover:text-flame-400"
        >
          <span class="i-ph-motorcycle text-sm" />
          Research horse riding and dirt biking
        </a>
      </div>
    </div>
  </header>

  <!-- Filter Bar -->
  <FilterBar
    areas={areas}
    timeCategories={timeCategories}
    cuisines={cuisines}
    countries={countries}
    totalCount={stalls.length}
    showCuisineFilter={cuisines.length > 1}
    showCountryFilter={countries.length > 1}
    defaultCountry="SG"
  />

  <!-- Stall Grid -->
  <main class="mx-auto max-w-6xl px-4 py-8">
    <div id="stall-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
      {stalls.map((stall) => (
        <StallCard stall={stall} showCuisine={cuisines.length > 1} minimal={true} />
      ))}
    </div>

    <!-- Empty state -->
    <div id="empty-state" class="hidden text-center py-8 sm:py-16">
      <span class="i-ph-magnifying-glass text-5xl text-ink-faint"></span>
      <p class="text-ink-muted mt-4 text-lg font-display">No stalls match your filters</p>
      <p class="text-ink-faint text-sm mt-1">Try adjusting your search or filters</p>
      <button id="clear-filters" class="mt-4 rounded-lg bg-flame-500/20 text-flame-400 px-4 py-3 text-sm font-medium hover:bg-flame-500/30 transition-colors cursor-pointer min-h-11">
        Clear all filters
      </button>
    </div>
  </main>

  <!-- Footer -->
  <footer class="border-t border-warm-800/40 py-8 text-center">
    <p class="text-ink-faint text-xs">
      Data sourced from
      <a
        href="https://docs.google.com/spreadsheets/d/1UMOZE2SM3_y5oUHafwJFEB9RrPDMqBbWjWnMGkO4gGg/edit?gid=1935025317"
        target="_blank"
        rel="noopener"
        class="text-flame-400/70 hover:text-flame-400 underline underline-offset-2 inline-block py-1"
      >
        SG Food Guide
      </a>
      spreadsheet.
    </p>
  </footer>
</Layout>

<script>
  import { initFilterSort } from '../scripts/filter-sort';
  initFilterSort();
</script>
